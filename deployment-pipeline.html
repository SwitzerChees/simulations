<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Pipeline Simulation</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        canvas {
            display: block;
        }
        .container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: flex;
            gap: 10px;
        }
        .stage {
            position: absolute;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .stage h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .gate {
            position: absolute;
            background-color: #6c757d;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 2;
        }
        .pipeline {
            position: absolute;
            background-color: #e9ecef;
            height: 10px;
            z-index: 1;
        }
        .code-package {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #0d6efd;
            border-radius: 5px;
            transition: all 0.5s ease;
            z-index: 3;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .pod {
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .pod::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 2px solid transparent;
            border-radius: 7px;
            transition: all 0.3s ease;
        }

        .pod.active::before {
            border-color: #10b981;
            animation: pulse-border 1.5s infinite;
        }

        @keyframes pulse-border {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .k8s-cluster {
            transition: all 0.3s ease;
        }

        .node {
            transition: all 0.3s ease;
        }

        .container-registry {
            transition: all 0.3s ease;
        }

        .container-registry .image {
            transition: all 0.3s ease;
        }

        .container-registry .image:hover {
            transform: translateX(5px);
            background-color: #f3f4f6;
        }
        .status-indicator {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            right: 10px;
            top: 10px;
        }
        .loading {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        .gate-popup {
            position: absolute;
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: none;
        }
        .gate-popup ul {
            margin: 0;
            padding-left: 20px;
        }
        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 10px;
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container">
        <!-- Stages -->
        <div id="dev-stage" class="stage bg-blue-100 text-blue-800" style="width: 200px; height: 150px; left: 100px; top: 50px;">
            <h3 class="text-lg">Development</h3>
            <p class="text-sm">Code is written and unit tested</p>
            <div class="status-indicator bg-gray-300"></div>
        </div>
        
        <!-- Test Environment with Kubernetes -->
        <div id="test-stage" class="stage bg-yellow-100 text-yellow-800" style="width: 400px; height: 300px; left: 400px; top: 50px;">
            <h3 class="text-lg">Testing Environment</h3>
            <p class="text-sm mb-4">Kubernetes Test Cluster</p>
            
            <!-- Kubernetes Test Cluster -->
            <div class="k8s-cluster bg-yellow-50 p-4 rounded-lg border-2 border-yellow-300">
                <div class="node bg-white p-2 rounded mb-2 shadow">
                    <h4 class="text-sm font-bold">Node 1</h4>
                    <div class="pods flex gap-2 mt-2">
                        <div class="pod bg-blue-200 p-2 rounded text-xs">
                            Node.js Pod
                        </div>
                        <div class="pod bg-orange-200 p-2 rounded text-xs">
                            DB Pod
                        </div>
                    </div>
                </div>
            </div>
            <div class="status-indicator bg-gray-300"></div>
        </div>
        
        <!-- Production Environment with Kubernetes -->
        <div id="prod-stage" class="stage bg-green-100 text-green-800" style="width: 400px; height: 300px; left: 900px; top: 50px;">
            <h3 class="text-lg">Production Environment</h3>
            <p class="text-sm mb-4">Kubernetes Production Cluster</p>
            
            <!-- Kubernetes Production Cluster -->
            <div class="k8s-cluster bg-green-50 p-4 rounded-lg border-2 border-green-300">
                <div class="node bg-white p-2 rounded mb-2 shadow">
                    <h4 class="text-sm font-bold">Node 1</h4>
                    <div class="pods flex gap-2 mt-2">
                        <div class="pod bg-blue-200 p-2 rounded text-xs">
                            Node.js Pod
                        </div>
                        <div class="pod bg-orange-200 p-2 rounded text-xs">
                            DB Pod
                        </div>
                    </div>
                </div>
                <div class="node bg-white p-2 rounded mb-2 shadow">
                    <h4 class="text-sm font-bold">Node 2</h4>
                    <div class="pods flex gap-2 mt-2">
                        <div class="pod bg-blue-200 p-2 rounded text-xs">
                            Node.js Pod
                        </div>
                        <div class="pod bg-orange-200 p-2 rounded text-xs">
                            DB Pod
                        </div>
                    </div>
                </div>
            </div>
            <div class="status-indicator bg-gray-300"></div>
        </div>
        
        <!-- Pipelines -->
        <div class="pipeline" style="width: 100px; left: 300px; top: 125px;"></div>
        <div class="pipeline" style="width: 100px; left: 800px; top: 125px;"></div>
        
        <!-- Quality Gates -->
        <div id="gate1" class="gate" style="width: 50px; height: 50px; left: 325px; top: 100px;">
            QG1
        </div>
        
        <div id="gate2" class="gate" style="width: 50px; height: 50px; left: 825px; top: 100px;">
            QG2
        </div>
        
        <!-- Container Registry -->
        <div class="container-registry bg-purple-100 text-purple-800 p-4 rounded-lg border-2 border-purple-300" 
             style="position: absolute; width: 150px; left: 525px; top: 400px;">
            <h4 class="text-sm font-bold">Container Registry</h4>
            <div class="images mt-2 text-xs">
                <div class="image bg-white p-2 rounded mb-1">nodejs-app:latest</div>
                <div class="image bg-white p-2 rounded">database:latest</div>
            </div>
        </div>
        
        <!-- Gate Popups -->
        <div id="gate1-popup" class="gate-popup" style="left: 350px; top: 260px;">
            <h4 class="font-bold">Quality Gate 1</h4>
            <ul>
                <li>Code review</li>
                <li>Unit tests pass (>80%)</li>
                <li>Static code analysis</li>
                <li>Build succeeds</li>
            </ul>
        </div>
        
        <div id="gate2-popup" class="gate-popup" style="left: 700px; top: 260px;">
            <h4 class="font-bold">Quality Gate 2</h4>
            <ul>
                <li>Integration tests pass</li>
                <li>Performance tests</li>
                <li>Security scan</li>
                <li>UAT approval</li>
            </ul>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <button id="startBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Start Deployment
            </button>
            <button id="resetBtn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                Reset
            </button>
        </div>
        
        <!-- Legend -->
        <div class="legend">
            <h4 class="font-bold mb-2">Legend</h4>
            <div class="legend-item">
                <div class="legend-color bg-blue-500"></div>
                <span>Code Package</span>
            </div>
            <div class="legend-item">
                <div class="legend-color bg-green-400"></div>
                <span>Success</span>
            </div>
            <div class="legend-item">
                <div class="legend-color bg-red-500"></div>
                <span>Failure</span>
            </div>
            <div class="legend-item">
                <div class="legend-color bg-yellow-400"></div>
                <span>In Progress</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #6c757d;"></div>
                <span>Quality Gate</span>
            </div>
        </div>
    </div>
    
    <script>
        // Main variables
        let deploymentStage = 0;
        let codePackage = null;
        let isRunning = false;
        let failureRate = 0.2; // 20% chance of failure at each gate
        
        // DOM elements
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const devStage = document.getElementById('dev-stage');
        const testStage = document.getElementById('test-stage');
        const prodStage = document.getElementById('prod-stage');
        const gate1 = document.getElementById('gate1');
        const gate2 = document.getElementById('gate2');
        const gate1Popup = document.getElementById('gate1-popup');
        const gate2Popup = document.getElementById('gate2-popup');
        
        // Event listeners
        startBtn.addEventListener('click', startDeployment);
        resetBtn.addEventListener('click', resetDeployment);
        
        // Gate popup listeners
        gate1.addEventListener('mouseenter', () => gate1Popup.style.display = 'block');
        gate1.addEventListener('mouseleave', () => gate1Popup.style.display = 'none');
        gate2.addEventListener('mouseenter', () => gate2Popup.style.display = 'block');
        gate2.addEventListener('mouseleave', () => gate2Popup.style.display = 'none');
        
        // Initialize the state
        function init() {
            updateStageStatus(devStage, 'idle');
            updateStageStatus(testStage, 'idle');
            updateStageStatus(prodStage, 'idle');
        }
        
        // Start the deployment process
        function startDeployment() {
            if (isRunning) return;
            
            isRunning = true;
            deploymentStage = 0;
            resetDeployment(false);
            
            // Create code package
            codePackage = document.createElement('div');
            codePackage.className = 'code-package';
            codePackage.style.left = (devStage.offsetLeft + devStage.offsetWidth / 2 - 15) + 'px';
            codePackage.style.top = (devStage.offsetTop + devStage.offsetHeight / 2 - 15) + 'px';
            document.querySelector('.container').appendChild(codePackage);
            
            // Start the deployment flow
            updateStageStatus(devStage, 'processing');
            simulateDevelopment();
        }

        // Create container image
        function createContainerImage() {
            const image = document.createElement('div');
            image.className = 'code-package';
            image.style.backgroundColor = '#818cf8'; // Indigo-400
            return image;
        }

        // Deploy containers to Kubernetes
        function deployToKubernetes(stage, onComplete) {
            const container = createContainerImage();
            document.querySelector('.container').appendChild(container);

            // Move to registry first
            const registry = document.querySelector('.container-registry');
            container.style.left = (registry.offsetLeft + registry.offsetWidth / 2 - 15) + 'px';
            container.style.top = (registry.offsetTop + 20) + 'px';

            setTimeout(() => {
                // Find target node in the stage
                const targetStage = stage === 'test' ? testStage : prodStage;
                const node = targetStage.querySelector('.node');
                const pods = node.querySelectorAll('.pod');

                // Animate containers to pods
                pods.forEach((pod, index) => {
                    const newContainer = createContainerImage();
                    document.querySelector('.container').appendChild(newContainer);
                    newContainer.style.left = container.style.left;
                    newContainer.style.top = container.style.top;

                    setTimeout(() => {
                        const rect = pod.getBoundingClientRect();
                        newContainer.style.left = (rect.left + window.scrollX) + 'px';
                        newContainer.style.top = (rect.top + window.scrollY) + 'px';
                        newContainer.style.transform = 'scale(0.5)';

                        setTimeout(() => {
                            pod.style.backgroundColor = index === 0 ? '#93c5fd' : '#fdba74';
                            pod.style.transform = 'scale(1.1)';
                            setTimeout(() => {
                                pod.style.transform = 'scale(1)';
                                newContainer.remove();
                            }, 300);
                        }, 500);
                    }, index * 500);
                });

                // Remove original container
                setTimeout(() => {
                    container.remove();
                    if (onComplete) onComplete();
                }, pods.length * 500 + 1000);
            }, 1000);
        }
        
        // Reset the deployment
        function resetDeployment(resetRunningState = true) {
            if (codePackage && codePackage.parentNode) {
                codePackage.parentNode.removeChild(codePackage);
            }
            
            codePackage = null;
            if (resetRunningState) {
                isRunning = false;
            }
            
            updateStageStatus(devStage, 'idle');
            updateStageStatus(testStage, 'idle');
            updateStageStatus(prodStage, 'idle');
        }
        
        // Update the visual status of a stage
        function updateStageStatus(element, status) {
            const indicator = element.querySelector('.status-indicator');
            
            switch(status) {
                case 'idle':
                    indicator.className = 'status-indicator bg-gray-300';
                    element.classList.remove('border-2', 'border-yellow-400', 'shadow-lg');
                    break;
                case 'processing':
                    indicator.className = 'status-indicator bg-yellow-400 loading';
                    element.classList.add('border-2', 'border-yellow-400', 'shadow-lg');
                    break;
                case 'success':
                    indicator.className = 'status-indicator bg-green-400';
                    element.classList.remove('border-2', 'border-yellow-400');
                    element.classList.add('border-2', 'border-green-400', 'shadow-lg');
                    break;
                case 'failure':
                    indicator.className = 'status-indicator bg-red-500';
                    element.classList.remove('border-2', 'border-yellow-400');
                    element.classList.add('border-2', 'border-red-500', 'shadow-lg');
                    break;
            }
        }
        
        // Move code package to a target
        function movePackageTo(target, onComplete) {
            const targetX = target.offsetLeft + target.offsetWidth / 2 - 15;
            const targetY = target.offsetTop + target.offsetHeight / 2 - 15;
            
            codePackage.style.left = targetX + 'px';
            codePackage.style.top = targetY + 'px';
            
            // Wait for transition to complete
            setTimeout(onComplete, 600);
        }
        
        // Development stage simulation
        function simulateDevelopment() {
            setTimeout(() => {
                updateStageStatus(devStage, 'success');
                deploymentStage = 1;
                
                // Move to first gate
                movePackageTo(gate1, checkGate1);
            }, 2000);
        }
        
        // Check first quality gate
        function checkGate1() {
            gate1.classList.add('bg-yellow-500');
            
            setTimeout(() => {
                const passed = Math.random() > failureRate;
                
                if (passed) {
                    gate1.classList.remove('bg-yellow-500');
                    gate1.classList.add('bg-green-500');
                    
                    setTimeout(() => {
                        // Move to test stage
                        movePackageTo(testStage, enterTestStage);
                    }, 1000);
                } else {
                    gate1.classList.remove('bg-yellow-500');
                    gate1.classList.add('bg-red-500');
                    
                    // Simulate failure
                    setTimeout(() => {
                        if (codePackage) {
                            codePackage.style.opacity = '0';
                            setTimeout(() => {
                                if (codePackage && codePackage.parentNode) {
                                    codePackage.parentNode.removeChild(codePackage);
                                }
                                codePackage = null;
                                isRunning = false;
                                gate1.classList.remove('bg-red-500');
                                gate1.classList.add('bg-gray-500');
                            }, 500);
                        }
                    }, 1000);
                }
            }, 2000);
        }
        
        // Enter test stage
        function enterTestStage() {
            updateStageStatus(testStage, 'processing');
            gate1.classList.remove('bg-green-500');
            gate1.classList.add('bg-gray-500');
            
            // Deploy to test environment
            deployToKubernetes('test', () => {
                setTimeout(() => {
                    updateStageStatus(testStage, 'success');
                    deploymentStage = 2;
                    
                    // Move to second gate
                    movePackageTo(gate2, checkGate2);
                }, 2000);
            });
        }
        
        // Check second quality gate
        function checkGate2() {
            gate2.classList.add('bg-yellow-500');
            
            setTimeout(() => {
                const passed = Math.random() > failureRate;
                
                if (passed) {
                    gate2.classList.remove('bg-yellow-500');
                    gate2.classList.add('bg-green-500');
                    
                    setTimeout(() => {
                        // Move to production stage
                        movePackageTo(prodStage, enterProdStage);
                    }, 1000);
                } else {
                    gate2.classList.remove('bg-yellow-500');
                    gate2.classList.add('bg-red-500');
                    
                    // Simulate failure
                    setTimeout(() => {
                        if (codePackage) {
                            codePackage.style.opacity = '0';
                            setTimeout(() => {
                                if (codePackage && codePackage.parentNode) {
                                    codePackage.parentNode.removeChild(codePackage);
                                }
                                codePackage = null;
                                isRunning = false;
                                gate2.classList.remove('bg-red-500');
                                gate2.classList.add('bg-gray-500');
                            }, 500);
                        }
                    }, 1000);
                }
            }, 2000);
        }
        
        // Enter production stage
        function enterProdStage() {
            updateStageStatus(prodStage, 'processing');
            gate2.classList.remove('bg-green-500');
            gate2.classList.add('bg-gray-500');
            
            // Deploy to production environment
            deployToKubernetes('prod', () => {
                setTimeout(() => {
                    updateStageStatus(prodStage, 'success');
                    deploymentStage = 3;
                    
                    // Enable restarting
                    isRunning = false;
                }, 2000);
            });
        }
        
        // Initialize on page load
        window.onload = init;
    </script>
</body>
</html>
